# üìÅ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞–ø–æ–∫ upload –∏ converted –Ω–∞ —Å–∞–π—Ç–µ

–¢–µ–ø–µ—Ä—å –Ω–∞ —Å–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–≤–µ –ø–∞–ø–∫–∏:

- **`/upload`** (–∏–ª–∏ `/files`) - –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Web App –≤–∏–¥–µ–æ
- **`/converted`** - —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–æ—Ç–æ–º –≤–∏–¥–µ–æ

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –û–±–Ω–æ–≤–∏—Ç–µ `.env` —Ñ–∞–π–ª webapp

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `webapp/.env`:

```env
# –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
PUBLIC_BASE_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.com
VIDEOS_DIR=videos
WEBAPP_PORT=8000
MAX_FILE_SIZE=2147483648

# –ù–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø–∞–ø–∫–∏ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
CONVERTED_DIR=converted
```

**–í–∞–∂–Ω–æ:** `CONVERTED_DIR` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –ø—É—Ç–µ–º –æ—Ç –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ `WebConvert` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `converted` –∏–ª–∏ `webapp/converted`).

### 2. –û–±–Ω–æ–≤–∏—Ç–µ `.env` —Ñ–∞–π–ª –±–æ—Ç–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
OPENAI_API_KEY=–≤–∞—à_–∫–ª—é—á
...

# –ù–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ –≤–µ–±-–ø–∞–ø–∫—É
WEBAPP_CONVERTED_DIR=webapp/converted
```

**–í–∞–∂–Ω–æ:** `WEBAPP_CONVERTED_DIR` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –ø—É—Ç–µ–º –æ—Ç –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ `WebConvert`.

### 3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx

**–í–ê–ñ–ù–û:** –ï—Å–ª–∏ —É –≤–∞—Å –æ—à–∏–±–∫–∞ `"location" directive is not allowed here`, —Å–º. —Ñ–∞–π–ª `NGINX_CONFIG_FIX.md` –¥–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```bash
sudo nano /etc/nginx/sites-available/video-upload
```

**–ü–æ–ª–Ω–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (–∑–∞–º–µ–Ω–∏—Ç–µ –≤–µ—Å—å —Ñ–∞–π–ª):

```nginx
server {
    listen 80;
    server_name –≤–∞—à-–¥–æ–º–µ–Ω.com www.–≤–∞—à-–¥–æ–º–µ–Ω.com;

    # –õ–æ–≥–∏
    access_log /var/log/nginx/video-upload-access.log;
    error_log /var/log/nginx/video-upload-error.log;

    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ (2GB)
    client_max_body_size 2G;
    client_body_timeout 300s;

    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ backend
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }

    # –†–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤ (–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ)
    location /videos/ {
        alias /root/WebConvert/webapp/videos/;
        autoindex off;
        add_header Content-Type video/mp4;
        add_header Accept-Ranges bytes;
        expires 30d;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin *;
        access_log off;
    }

    # –†–∞–∑–¥–∞—á–∞ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤
    location /converted/ {
        alias /root/WebConvert/webapp/converted/;
        autoindex off;
        add_header Content-Type video/mp4;
        add_header Accept-Ranges bytes;
        expires 30d;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin *;
        access_log off;
    }
}
```

**–í–∞–∂–Ω–æ:**

- –ó–∞–º–µ–Ω–∏—Ç–µ `–≤–∞—à-–¥–æ–º–µ–Ω.com` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
- –í—Å–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `location` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–≤–Ω—É—Ç—Ä–∏** –±–ª–æ–∫–∞ `server { }`
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞–º–µ–Ω–∏—Ç–µ `/root/WebConvert` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å

**–í–∞–∂–Ω–æ:** –ó–∞–º–µ–Ω–∏—Ç–µ `/root/WebConvert/webapp/converted/` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx
sudo systemctl restart nginx
```

### 5. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É converted

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –¥–ª—è —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
mkdir -p /root/WebConvert/webapp/converted
chmod 755 /root/WebConvert/webapp/converted
```

### 6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ webapp
sudo systemctl restart webapp

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
sudo systemctl restart WebConvert
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü:**

   ```bash
   # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
   curl https://–≤–∞—à-–¥–æ–º–µ–Ω.com/files

   # –°–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
   curl https://–≤–∞—à-–¥–æ–º–µ–Ω.com/converted
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ Web App:**

   - –û—Ç–∫—Ä–æ–π—Ç–µ Web App —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "üé¨ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ" –≤ –±–æ—Ç–µ
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–Ω–æ–ø–∫–∏:
     - "üìÅ –í—Å–µ —Ñ–∞–π–ª—ã" - –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
     - "üé¨ –°–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ" - —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é:**
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –≤–∏–¥–µ–æ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
   - –ü–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –ø–∞–ø–∫–µ `webapp/converted/`
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/converted` - —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

```
WebConvert/
‚îú‚îÄ‚îÄ bot.py
‚îú‚îÄ‚îÄ converted/              # –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ (—É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏)
‚îú‚îÄ‚îÄ downloads/              # –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è —Å–∫–∞—á–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
‚îî‚îÄ‚îÄ webapp/
    ‚îú‚îÄ‚îÄ server.py
    ‚îú‚îÄ‚îÄ videos/             # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Web App –≤–∏–¥–µ–æ
    ‚îÇ   ‚îî‚îÄ‚îÄ *.mp4
    ‚îî‚îÄ‚îÄ converted/          # –°–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–æ—Ç–æ–º –≤–∏–¥–µ–æ (–≤–µ–±-–¥–æ—Å—Ç—É–ø)
        ‚îî‚îÄ‚îÄ *_converted.mp4
```

## üîç –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

- **`/upload`** - —Ñ–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ
- **`/files`** - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
- **`/converted`** - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
- **`/videos/{filename}`** - –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –≤–∏–¥–µ–æ
- **`/converted/{filename}`** - –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –§–∞–π–ª—ã –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ /converted

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**

   ```bash
   ls -la /root/WebConvert/webapp/converted/
   chmod 755 /root/WebConvert/webapp/converted/
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã:**

   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
   sudo journalctl -u WebConvert -n 50 | grep -i converted
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx:**
   ```bash
   sudo nginx -t
   sudo tail -f /var/log/nginx/error.log
   ```

### 403 Forbidden –¥–ª—è /converted/

–°–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é `FIX_403_VIDEOS.md` - –ø—Ä–∏–º–µ–Ω–∏—Ç–µ —Ç–µ –∂–µ —à–∞–≥–∏ –¥–ª—è –ø–∞–ø–∫–∏ `converted/`.
